---
title: 'OSSN任意文件读取漏洞（CVE-2020-10560）'
date: Sat, 19 Sep 2020 07:20:04 +0000
draft: false
tags: ['白阁-漏洞库']
---

#### 漏洞简介

Open Source Social Network(OSSN)5.3之前版本中存在一处任意文件读取漏洞（CVE-2020-10560）。漏洞因OSSN生成的Site\_Key强度过低从而可以遭受被暴力破解而产生，成功破解Site\_Key的攻击者可以利用Site\_Key构造出任意文件读取链接，通过components\\OssnComments\\ossn\_com.php文件提供的文件预览接口，读取文件。 漏洞利用 评论帖子时，用户可以上传图片及表情， ![](https://www.bylibrary.cn/wp-content/uploads/2020/09/qqq.png) 当选择本地图片并上传后，将在评论中生成一个预览 ![](https://www.bylibrary.cn/wp-content/uploads/2020/09/www.png) 注意，这时还没有点击发布评论，上图图片只是上传成功后的一个预览图片。该临时图像文件存储于tmp目录并在前端呈现了预览。 我们来看下这个临时图片文件是如何获取并在页面中展示的。查看一下图片链接 ![](https://www.bylibrary.cn/wp-content/uploads/2020/09/eeee.png) 在临时图片文件被上传到服务器时，会被存储于ossn\_data/tmp/photos文件夹中 攻击者在评论里上传一个图片，不点击发送，查看此时图片临时预览链接，获取链接中image参数值。例如：```
http://192.167.30.119/comment/staticimage?image=UiszT0RJYStoQll2N2g5cHhmQW9PRHlCNVgrSWFKVzFQRHE4eTJqSWthVUVjUFBIb3pxME1FNUJFdk5ER2pONXI4V2pyeXJSMm9VPQ==中的UiszT0RJYStoQll2N2g5cHhmQW9PRHlCNVgrSWFKVzFQRHE4eTJqSWthVUVjUFBIb3pxME1FNUJFdk5ER2pONXI4V2pyeXJSMm9VPQ== 
```将数字0-2147483647依次带入ossn\_generate\_site\_secret中计算出对应的site\_key 依次将site\_key与image值带入ossn\_string\_decrypt中，获取解密后的明文 如果明文中含有tmp/photos字符串，解密成功，此时的site\_key即为正确的site\_key值 在获取site\_key值后，可以通过ossn\_string\_encrypt方法，对想要读取的文件进行加密，通过http://192.167.30.119/comment/staticimage?image=接口进行读取即可 上文所涉及的工具如下： site\_key计算工具 https://github.com/LucidUnicorn/CVE-2020-10560-Key-Recovery 加密解密工具 https://github.com/kevthehermit/CVE-2020-10560